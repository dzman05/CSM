<!DOCTYPE html>

<html lang="ar" dir="rtl">



<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>غرفة العمليات المركزية | وزارة السياحة والصناعة التقليدية</title>



    <!-- Professional Fonts & Icons -->

    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Outfit:wght@300;400;600;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">



    <!-- Maps & Charts -->

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />



    <style>
        :root {

            --primary: #065f46;

            /* Emerald Green (Ministry) */

            --primary-light: #10b981;

            --secondary: #b45309;

            /* Desert Gold/Amber */

            --accent: #3b82f6;

            /* Blue */

            --bg-body: #f8fafc;

            --sidebar-bg: #064e3b;

            --card-glass: rgba(255, 255, 255, 0.85);

            --text-main: #1e293b;

            --text-muted: #64748b;

            --white: #ffffff;

            --shadow: 0 10px 30px rgba(0, 0, 0, 0.05);

            --radius: 16px;

        }



        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

            font-family: 'Cairo', 'Segoe UI', Tahoma, sans-serif;

        }



        body {

            background: var(--bg-body);

            color: var(--text-main);

            overflow: hidden;

            height: 100vh;

        }



        /* Login Overlay Modernized */

        #login-overlay {

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background: linear-gradient(135deg, var(--primary) 0%, #064e3b 100%);

            z-index: 10000;

            display: flex;

            align-items: center;

            justify-content: center;

        }



        .login-glass {

            background: rgba(255, 255, 255, 0.1);

            backdrop-filter: blur(20px);

            border: 1px solid rgba(255, 255, 255, 0.2);

            padding: 40px;

            border-radius: 24px;

            width: 450px;

            text-align: center;

            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);

            animation: fadeIn 0.8s ease-out;

        }



        @keyframes fadeIn {

            from {

                opacity: 0;

                transform: scale(0.9);

            }



            to {

                opacity: 1;

                transform: scale(1);

            }

        }



        .login-logo {

            width: 120px;

            background: white;

            padding: 15px;

            border-radius: 50%;

            margin-bottom: 25px;

            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);

        }



        .login-glass h1 {

            color: white;

            margin-bottom: 30px;

            font-weight: 800;

            font-size: 1.6rem;

            line-height: 1.4;

        }



        .input-group {

            position: relative;

            margin-bottom: 20px;

            text-align: right;

        }



        .input-group label {

            display: block;

            color: white;

            margin-bottom: 8px;

            font-size: 0.9rem;

            opacity: 0.9;

        }



        .input-group i {

            position: absolute;

            right: 15px;

            top: 40px;

            color: var(--primary-light);

        }



        .input-group input {

            width: 100%;

            padding: 12px 45px 12px 15px;

            border-radius: 12px;

            border: none;

            background: rgba(255, 255, 255, 0.95);

            font-size: 1rem;

            transition: 0.3s;

        }



        .input-group input:focus {

            outline: none;

            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);

        }



        .login-btn {

            width: 100%;

            padding: 14px;

            border-radius: 12px;

            border: none;

            background: var(--secondary);

            color: white;

            font-size: 1.1rem;

            font-weight: 700;

            cursor: pointer;

            transition: 0.3s;

            margin-top: 10px;

        }



        .login-btn:hover {

            background: #d97706;

            transform: translateY(-2px);

        }



        /* Main App Layout */

        .app-container {

            display: flex;

            height: 100vh;

            width: 100vw;

        }



        /* Sidebar Styling */

        .sidebar {

            width: 280px;

            background: var(--sidebar-bg);

            color: white;

            padding: 30px 0;

            display: flex;

            flex-direction: column;

            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);

            position: relative;

            z-index: 100;

            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.1);

        }



        .sidebar-header {

            padding: 0 25px 30px;

            border-bottom: 1px solid rgba(255, 255, 255, 0.1);

            margin-bottom: 20px;

            text-align: center;

        }



        .sidebar-header img {

            width: 70px;

            margin-bottom: 15px;

        }



        .sidebar-header h2 {

            font-size: 1.1rem;

            font-weight: 700;

            color: #fff;

        }



        .nav-items {

            flex: 1;

            padding: 0 15px;

        }



        .nav-link {

            display: flex;

            align-items: center;

            padding: 14px 20px;

            color: rgba(255, 255, 255, 0.7);

            text-decoration: none;

            border-radius: 12px;

            margin-bottom: 5px;

            transition: 0.3s;

            font-weight: 600;

            cursor: pointer;

        }



        .nav-link i {

            margin-left: 15px;

            font-size: 1.2rem;

            width: 25px;

            text-align: center;

        }



        .nav-link:hover,

        .nav-link.active {

            background: rgba(255, 255, 255, 0.1);

            color: white;

        }



        .nav-link.active {

            background: var(--primary-light);

            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);

        }



        .sidebar-footer {

            padding: 20px;

            border-top: 1px solid rgba(255, 255, 255, 0.1);

            text-align: center;

            font-size: 0.8rem;

            color: rgba(255, 255, 255, 0.5);

        }



        /* Workbench */

        .workbench {

            flex: 1;

            display: flex;

            flex-direction: column;

            overflow: hidden;

            background: #f1f5f9;

        }



        .top-bar {

            height: 70px;

            background: white;

            display: flex;

            align-items: center;

            justify-content: space-between;

            padding: 0 30px;

            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);

            z-index: 50;

        }



        .top-right-title {

            display: flex;

            align-items: center;

            gap: 15px;

        }



        .top-left-actions {

            display: flex;

            align-items: center;

            gap: 20px;

        }



        .action-icon {

            font-size: 1.3rem;

            color: var(--text-muted);

            cursor: pointer;

            transition: 0.3s;

            position: relative;

        }



        .action-icon:hover {

            color: var(--primary);

        }



        .badge {

            position: absolute;

            top: -5px;

            right: -8px;

            background: #ef4444;

            color: white;

            font-size: 0.6rem;

            padding: 2px 5px;

            border-radius: 50%;

            font-weight: 800;

            border: 2px solid white;

        }



        /* Live Ticker Styling */

        .ticker-bar {

            height: 35px;

            background: var(--primary);

            color: rgba(255, 255, 255, 0.9);

            display: flex;

            align-items: center;

            overflow: hidden;

            border-bottom: 1px solid rgba(255, 255, 255, 0.1);

            font-size: 0.85rem;

            font-weight: 600;

            z-index: 40;

        }



        .ticker-label {

            background: var(--secondary);

            color: white;

            padding: 0 20px;

            height: 100%;

            display: flex;

            align-items: center;

            white-space: nowrap;

            position: relative;

            z-index: 2;

            box-shadow: 10px 0 15px rgba(0, 0, 0, 0.2);

        }



        .ticker-content {

            display: flex;

            white-space: nowrap;

            animation: tickerMove 60s linear infinite;

        }



        @keyframes tickerMove {

            0% {

                transform: translateX(100%);

            }



            100% {

                transform: translateX(-100%);

            }

        }



        .ticker-item {

            margin-left: 60px;

            display: flex;

            align-items: center;

            gap: 10px;

        }



        .ticker-item i {

            color: var(--primary-light);

        }



        /* Content Area */

        .main-content {

            flex: 1;

            overflow-y: auto;

            padding: 25px;

        }



        .view-section {

            display: none;

            width: 100%;

            animation: fadeIn 0.4s ease-out;

        }



        .view-section.active {

            display: block;

        }



        /* KPI Cards Modern */

        .metrics-grid {

            display: grid;

            grid-template-columns: repeat(4, 1fr);

            gap: 20px;

            margin-bottom: 30px;

        }



        .metric-card {

            background: var(--white);

            border-radius: var(--radius);

            padding: 25px;

            display: flex;

            align-items: center;

            gap: 20px;

            box-shadow: var(--shadow);

            transition: 0.3s;

            position: relative;

            overflow: hidden;

        }



        .metric-card:hover {

            transform: translateY(-5px);

            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);

        }



        .m-icon {

            width: 55px;

            height: 55px;

            background: #f0fdf4;

            color: var(--primary-light);

            border-radius: 14px;

            display: flex;

            align-items: center;

            justify-content: center;

            font-size: 1.6rem;

        }



        .m-icon.orange {

            background: #fff7ed;

            color: var(--secondary);

        }



        .m-icon.blue {

            background: #eff6ff;

            color: var(--accent);

        }



        .m-icon.red {

            background: #fef2f2;

            color: #ef4444;

        }



        .m-data h4 {

            font-size: 0.85rem;

            color: var(--text-muted);

            margin-bottom: 5px;

        }



        .m-data .value {

            font-size: 1.6rem;

            font-weight: 800;

            color: var(--primary);

        }



        /* Map & Analytics Section */

        .dashboard-row {

            display: grid;

            grid-template-columns: 1.5fr 1fr;

            gap: 25px;

            margin-bottom: 30px;

        }



        .glass-box {

            background: var(--card-glass);

            backdrop-filter: blur(10px);

            border: 1px solid rgba(255, 255, 255, 0.2);

            border-radius: var(--radius);

            padding: 25px;

            box-shadow: var(--shadow);

        }



        .box-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 20px;

        }



        .box-header h3 {

            font-size: 1.2rem;

            font-weight: 700;

            display: flex;

            align-items: center;

            gap: 10px;

        }



        .box-header h3 i {

            color: var(--primary);

        }



        #algeria-map {

            height: 500px;

            border-radius: 12px;

            z-index: 10;

            border: 1px solid #e2e8f0;

        }



        /* Wilayas Directory Grid */

        .wilayas-grid {

            display: grid;

            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));

            gap: 20px;

            margin-top: 20px;

        }



        .wilaya-card {

            background: white;

            border-radius: 12px;

            padding: 20px;

            box-shadow: var(--shadow);

            border: 1px solid #f1f5f9;

            transition: 0.3s;

            cursor: pointer;

            position: relative;

        }



        .wilaya-card:hover {

            transform: translateY(-3px);

            border-color: var(--primary-light);

        }



        .wilaya-card h4 {

            font-weight: 800;

            margin-bottom: 15px;

            display: flex;

            justify-content: space-between;

            align-items: center;

        }



        .wilaya-card .code {

            font-size: 0.75rem;

            color: var(--text-muted);

            background: #f1f5f9;

            padding: 2px 6px;

            border-radius: 4px;

        }



        .w-stat {

            font-size: 0.8rem;

            color: var(--text-muted);

            margin-bottom: 8px;

            display: flex;

            justify-content: space-between;

        }



        .w-stat b {

            color: var(--text-main);

        }



        .status-dot {

            width: 10px;

            height: 10px;

            border-radius: 50%;

            display: inline-block;

            margin-left: 5px;

        }



        .dot-online {

            background: #10b981;

            box-shadow: 0 0 10px #10b981;

        }



        .dot-offline {

            background: #cbd5e1;

        }



        /* Table Design */

        .table-container {

            margin-top: 30px;

        }



        .modern-table {

            width: 100%;

            border-collapse: separate;

            border-spacing: 0 8px;

        }



        .modern-table th {

            padding: 15px;

            text-align: right;

            color: var(--text-muted);

            font-size: 0.85rem;

            text-transform: uppercase;

            letter-spacing: 1px;

        }



        .modern-table tbody tr {

            background: white;

            transition: 0.3s;

        }



        .modern-table tbody tr:hover {

            transform: scale(1.005);

            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);

        }



        .modern-table td {

            padding: 15px;

            font-weight: 600;

            font-size: 0.95rem;

        }



        .modern-table td:first-child {

            border-radius: 12px 0 0 12px;

        }



        .modern-table td:last-child {

            border-radius: 0 12px 12px 0;

        }



        .status-pill {

            padding: 5px 12px;

            border-radius: 20px;

            font-size: 0.75rem;

            font-weight: 700;

            text-align: center;

            display: inline-block;

        }



        .pill-active {

            background: #dcfce7;

            color: #166534;

        }



        .pill-inactive {

            background: #fef2f2;

            color: #991b1b;

        }



        /* Modal Redesign */

        .modal-overlay {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background: rgba(0, 30, 20, 0.6);

            backdrop-filter: blur(8px);

            z-index: 5000;

            align-items: center;

            justify-content: center;

        }



        .modal-card {

            background: white;

            width: 650px;

            border-radius: 24px;

            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);

            overflow: hidden;

            animation: slideUp 0.4s ease;

        }



        @keyframes slideUp {

            from {

                transform: translateY(50px);

                opacity: 0;

            }



            to {

                transform: translateY(0);

                opacity: 1;

            }

        }



        .modal-header-pro {

            background: var(--sidebar-bg);

            padding: 25px;

            color: white;

            display: flex;

            justify-content: space-between;

            align-items: center;

        }



        .modal-body-pro {

            padding: 30px;

        }



        footer {

            margin-top: 40px;

            padding: 25px;

            text-align: center;

            border-top: 1px solid #e2e8f0;

            color: var(--text-muted);

            font-size: 0.9rem;

            background: white;

        }



        .chart-container {

            height: 350px;

        }



        /* Notifications Dropdown */

        .notifications-dropdown {

            position: absolute;

            top: 70px;

            left: 20px;

            width: 350px;

            background: white;

            border-radius: 16px;

            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);

            display: none;

            flex-direction: column;

            z-index: 1000;

            border: 1px solid #eee;

            overflow: hidden;

            animation: slideDown 0.3s ease;

        }

        @keyframes slideDown {
            from {
                transform: translateY(-10px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }



        .notif-header {

            padding: 15px 20px;

            background: #f8fafc;

            border-bottom: 1px solid #eee;

            display: flex;

            justify-content: space-between;

            align-items: center;

        }

        .notif-header h4 {
            margin: 0;
            color: var(--primary);
            font-size: 1rem;
        }

        .notif-list {

            max-height: 400px;

            overflow-y: auto;

        }

        .notif-item {

            padding: 12px 20px;

            border-bottom: 1px solid #f1f5f9;

            display: flex;

            gap: 12px;

            transition: 0.2s;

            cursor: pointer;

            text-align: right;

            align-items: center;

        }

        .notif-item:hover {
            background: #f0fdf4;
        }

        .notif-item i {
            color: #10b981;
        }

        .notif-item-content {
            flex: 1;
        }

        .notif-title {
            font-weight: 700;
            font-size: 0.85rem;
            margin-bottom: 2px;
        }

        .notif-time {
            font-size: 0.7rem;
            color: #94a3b8;
        }



        /* Global Search Style */

        .search-box-container {

            position: absolute;

            top: 20px;

            right: 80px;

            z-index: 1000;

            width: 300px;

        }

        .search-input-wrapper {

            background: white;

            border-radius: 30px;

            padding: 8px 15px;

            display: flex;

            align-items: center;

            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);

            border: 1px solid #ddd;

        }

        .search-input-wrapper input {

            border: none;

            outline: none;

            width: 100%;

            margin-right: 10px;

            font-family: 'Cairo', sans-serif;

            font-size: 0.9rem;

        }



        /* Dark Mode variables and classes */

        body.dark-mode {

            background: #0f172a;

            color: #f8fafc;

        }

        .dark-mode .workbench,
        .dark-mode .top-bar,
        .dark-mode footer {

            background: #1e293b;

            color: white;

            border-color: #334155;

        }

        .dark-mode .metric-card,
        .dark-mode .glass-box,
        .dark-mode .modern-table tbody tr {

            background: #334155;

            color: white;

            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);

            border-color: #475569;

        }

        .dark-mode .top-bar h2,
        .dark-mode .user-info .name {
            color: #f8fafc;
        }

        .dark-mode .modern-table th {
            color: #94a3b8;
        }

        .dark-mode .modern-table td {
            color: #e2e8f0;
        }

        .dark-mode .sidebar {
            background: #020617;
        }

        .dark-mode .sidebar-header {
            border-bottom-color: #1e293b;
        }



        .theme-toggle-btn {

            background: #f1f5f9;

            border: 1px solid #ddd;

            width: 40px;

            height: 40px;

            border-radius: 50%;

            cursor: pointer;

            display: flex;

            align-items: center;

            justify-content: center;

            transition: 0.3s;

            margin-left: 15px;

        }

        .dark-mode .theme-toggle-btn {

            background: #334155;

            border-color: #475569;

            color: #fbbf24;

        }


        .hamburger-menu {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--primary);
            margin-left: 15px;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
        }

        .sidebar-overlay.active {
            display: block;
        }

        /* === RESPONSIVE DESIGN FOR MOBILE === */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                padding: 15px 0;
            }

            .sidebar-header img {
                width: 120px;
            }

            .nav-items {
                display: flex;
                overflow-x: auto;
                gap: 10px;
                padding: 10px;
            }

            .nav-link {
                white-space: nowrap;
                flex-shrink: 0;
            }

            .top-bar {
                height: auto;
                padding: 15px;
                flex-wrap: wrap;
            }

            .top-right-title h2 {
                font-size: 0.9rem !important;
            }

            .top-left-actions {
                width: 100%;
                margin-top: 10px;
                justify-content: space-around;
            }

            .ticker-bar {
                font-size: 0.7rem;
                padding: 8px 0;
            }

            .ticker-label {
                font-size: 0.7rem;
                padding: 0 10px;
            }

            .main-content {
                padding: 15px;
            }

            .metrics-grid {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }

            .dashboard-row {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }

            .wilayas-grid {
                grid-template-columns: 1fr !important;
            }

            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .modern-table {
                min-width: 700px;
                font-size: 0.8rem;
            }

            .modern-table th,
            .modern-table td {
                padding: 10px 8px;
                font-size: 0.75rem;
            }

            .glass-box {
                padding: 15px;
            }

            .box-header {
                flex-direction: column;
                align-items: flex-start !important;
                gap: 10px;
            }

            .box-header h3 {
                font-size: 0.95rem;
            }

            .chart-container {
                height: 250px !important;
            }

            #algeria-map {
                height: 350px !important;
            }

            .login-glass {
                width: 90%;
                padding: 25px;
            }

            .modal-card {
                width: 95%;
                margin: 0 10px;
            }

            .modal-body-pro {
                padding: 20px;
            }

            .metric-card {
                padding: 18px;
                flex-direction: row;
            }

            .m-icon {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
            }

            .m-data .value {
                font-size: 1.4rem;
            }

            .m-data h4 {
                font-size: 0.8rem;
            }

            .search-box-container {
                position: static;
                width: 100%;
                margin: 10px 0;
            }

            .notifications-dropdown {
                width: 95%;
                left: 2.5%;
            }

            .user-profile {
                flex-direction: column;
                align-items: center;
                gap: 10px;
                padding: 10px;
                border: none !important;
            }

            .user-info {
                text-align: center;
            }

            footer {
                padding: 20px 15px;
                font-size: 0.8rem;
            }

            .login-btn {
                padding: 12px;
                font-size: 0.9rem;
            }

            .wilaya-card {
                padding: 15px;
            }

            .sidebar-footer {
                font-size: 0.7rem;
                padding: 10px;
            }
        }
    </style>

</head>



<body>



    <div id="login-overlay" style="display: none !important;">

        <div class="login-glass">

            <img src="assets/img/logo%20minister.png" alt="وزارة السياحة والصناعة التقليدية"
                style="width: 280px; margin-bottom: 25px;">

            <div class="input-group">

                <label>معرف المستخدم</label>

                <i class="fas fa-user-shield"></i>

                <input type="text" id="username" placeholder="أدخل اسم المستخدم">

            </div>

            <div class="input-group">

                <label>كلمة المرور المشفرة</label>

                <i class="fas fa-key"></i>

                <input type="password" id="password" placeholder="••••••••">

            </div>

            <button class="login-btn" onclick="checkLogin()">دخول آمن للنظام <i class="fas fa-fingerprint"
                    style="margin-right: 10px;"></i></button>

            <p id="login-error" style="color: #fecaca; margin-top: 15px; display: none; font-size: 0.9rem;">بيانات

                الدخول غير صحيحة، تم تسجيل المحاولة.</p>

        </div>

    </div>



    <div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>
    <div class="app-container" id="dashboard-app" style="display: flex !important;">

        <aside class="sidebar" id="sidebar">

            <div class="sidebar-header">

                <img src="assets/img/logo%20minister.png" alt="وزارة السياحة والصناعة التقليدية"
                    style="width: 200px; padding: 10px;">

            </div>

            <nav class="nav-items">

                <div class="nav-link" onclick="switchView('overview', this); closeSidebarOnMobile()"><i
                        class="fas fa-gauge-high"></i> نظرة عامة
                </div>
                <div class="nav-link" onclick="switchView('directory', this); closeSidebarOnMobile()"><i
                        class="fas fa-city"></i> دليل الولايات
                    (58)</div>
                <div class="nav-link" onclick="switchView('analytics', this); closeSidebarOnMobile()"><i
                        class="fas fa-chart-pie"></i> التحليل
                    الوطني</div>
                <div class="nav-link" onclick="switchView('reports', this); closeSidebarOnMobile()"><i
                        class="fas fa-file-pdf"></i> التقارير
                    الرسمية</div>
                <div class="nav-link" onclick="switchView('security', this); closeSidebarOnMobile()"><i
                        class="fas fa-shield-halved"></i> الأمان
                    والسجلات</div>
                <div class="nav-link" onclick="switchView('settings', this); closeSidebarOnMobile()"><i
                        class="fas fa-cog"></i> الإعدادات</div>

            </nav>

            <div class="sidebar-footer">

                نظام CSM-CAM المركزي<br>v1.0.0

            </div>

        </aside>



        <main class="workbench">

            <header class="top-bar">

                <div class="top-right-title">
                    <div class="hamburger-menu" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </div>

                    <h2 style="font-weight: 800; color: var(--primary);"><i class="fas fa-tower-observation"
                            style="margin-left: 10px;"></i> مركز الاحصائيات الوطني لمدارس التكوين وتحسين المستوى</h2>

                </div>

                <div class="top-left-actions">

                    <button class="theme-toggle-btn" onclick="toggleDarkMode()" title="تبديل الوضع الليلي">

                        <i class="fas fa-moon"></i>

                    </button>

                    <div class="action-icon" title="الإشعارات" onclick="toggleNotifications(event)">

                        <i class="fas fa-bell"></i>

                        <span class="badge" id="notif-badge">0</span>

                    </div>

                    <div class="notifications-dropdown" id="notif-dropdown">

                        <div class="notif-header">

                            <h4>تنبيهات المزامنة الأخيرة</h4>

                            <span id="notif-count-text" style="font-size:0.75rem; color:#059669; font-weight:bold;">0
                                ولاية</span>

                        </div>

                        <div class="notif-list" id="notif-list">

                            <!-- Populated by JS -->

                        </div>

                    </div>

                    <div class="user-profile" style="border-right: 1px solid #eee; padding-right: 20px;">

                        <div class="user-info">

                            <div class="name">يسين عيشي</div>

                            <div class="role">مدير الأنظمة المركزية</div>

                        </div>

                        <div class="avatar">YA</div>

                        <button onclick="logout()"
                            style="background: none; border: none; color: #ef4444; cursor: pointer; font-size: 1.2rem; margin-right: 15px;"><i
                                class="fas fa-power-off"></i></button>

                    </div>

                </div>

            </header>



            <div class="ticker-bar">

                <div class="ticker-label"><i class="fas fa-bolt" style="margin-left: 8px;"></i> بث مباشر للنشاط الوطني

                </div>

                <div class="ticker-content" id="live-ticker">

                    <!-- Dynamic Items Filled by JS -->

                </div>

            </div>



            <div class="main-content">



                <section id="overview-section" class="view-section active">

                    <div class="metrics-grid">

                        <div class="metric-card">

                            <div class="m-icon blue"><i class="fas fa-user-graduate"></i></div>

                            <div class="m-data">

                                <h4>إجمالي المتربصين</h4>

                                <div class="value" id="total-students">0</div>

                            </div>

                        </div>

                        <div class="metric-card">

                            <div class="m-icon red"><i class="fas fa-file-signature"></i></div>

                            <div class="m-data">

                                <h4>طلبات التسجيل</h4>

                                <div class="value" id="total-requests">0</div>

                            </div>

                        </div>

                        <div class="metric-card">

                            <div class="m-icon orange"><i class="fas fa-chalkboard-user"></i></div>

                            <div class="m-data">

                                <h4>المكونين المعتمدين</h4>

                                <div class="value" id="total-teachers">0</div>

                            </div>

                        </div>

                        <div class="metric-card">

                            <div class="m-icon"><i class="fas fa-satellite-dish"></i></div>

                            <div class="m-data">

                                <h4>حالة المزامنة</h4>

                                <div class="value" id="active-centers">0 / 58</div>

                            </div>
                        </div>
                    </div>

                    <!-- Demographics Row -->
                    <div class="metrics-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 30px;">
                        <div class="glass-box">
                            <div class="box-header">
                                <h3><i class="fas fa-users-cog"></i> الفئات العمرية</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="ageGroupsChart"></canvas>
                            </div>
                        </div>
                        <div class="glass-box">
                            <div class="box-header">
                                <h3><i class="fas fa-shapes"></i> أنماط التكوين</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="trainingTypeChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-row">

                        <div class="glass-box">

                            <div class="box-header">

                                <h3><i class="fas fa-map-marked-alt"></i> الخريطة التفاعلية للنشاط التكويني</h3>

                            </div>

                            <div style="position:relative;">
                                <div id="algeria-map"></div>
                                <div class="search-box-container">

                                    <div class="search-input-wrapper">

                                        <i class="fas fa-search" style="color:#94a3b8;"></i>

                                        <input type="text" id="global-search" placeholder="ابحث عن ولاية أو كود..."
                                            onkeyup="handleGlobalSearch()">

                                    </div>

                                </div>
                            </div>

                        </div>

                        <div class="glass-box">

                            <div class="box-header">

                                <h3><i class="fas fa-ranking-star"></i> أعلى 5 ولايات نشاطاً</h3>

                            </div>

                            <div class="chart-container"><canvas id="topWilayasChart"></canvas></div>

                        </div>

                    </div>



                    <div class="glass-box table-container">

                        <div class="box-header">

                            <h3><i class="fas fa-list-ol"></i> مؤشرات الولايات (آخر المزامنات)</h3>

                            <button class="login-btn" style="width: auto; padding: 6px 15px; font-size: 0.8rem;"
                                onclick="refreshStats()">تحديث البيانات <i class="fas fa-sync"></i></button>

                        </div>

                        <table class="modern-table">

                            <thead>

                                <tr>

                                    <th>الكود</th>
                                    <th>الولاية</th>
                                    <th>المتربصين (ذ/ث)</th>
                                    <th>نسبة النجاح</th>
                                    <th>المتخرجين</th>
                                    <th>التخصص الأنشط</th>
                                    <th>آخر ظهور</th>
                                    <th>الحالة</th>

                                </tr>

                            </thead>

                            <tbody id="stats-table-body"></tbody>

                        </table>

                    </div>

                </section>



                <section id="directory-section" class="view-section">

                    <div class="glass-box">

                        <div class="box-header">

                            <div>

                                <h3><i class="fas fa-city"></i> دليل الولايات (58)</h3>

                            </div>

                            <input type="text" id="wilaya-search" placeholder="ابحث عن ولاية..."
                                onkeyup="filterWilayas()"
                                style="padding: 10px 15px; border-radius: 10px; border: 1px solid #ddd; width: 250px;">

                        </div>

                        <div class="wilayas-grid" id="full-wilayas-directory"></div>

                    </div>

                </section>



                <section id="analytics-section" class="view-section">

                    <div class="metrics-grid">

                        <div class="glass-box">

                            <h3 style="margin-bottom:20px;"><i class="fas fa-venus-mars"></i> التوزيع النوعي الوطني</h3>

                            <div class="chart-container" style="height: 300px;"><canvas id="genderChart"></canvas></div>

                        </div>

                        <div class="glass-box">

                            <h3 style="margin-bottom:20px;"><i class="fas fa-graduation-cap"></i> مستويات التأهيل</h3>

                            <div class="chart-container" style="height: 300px;"><canvas id="educationChart"></canvas>

                            </div>

                        </div>

                    </div>



                    <div class="dashboard-row" style="margin-top:25px;">

                        <div class="glass-box">

                            <h3 style="margin-bottom:20px;"><i class="fas fa-chart-bar"></i> مقارنة الإقبال والطلب (حسب

                                الولاية)</h3>

                            <div class="chart-container" style="height: 400px;"><canvas id="comparisonChart"></canvas>

                            </div>

                        </div>

                        <div class="glass-box">

                            <h3 style="margin-bottom:20px;"><i class="fas fa-trophy"></i> التخصصات الأكثر رواجاً</h3>

                            <div class="chart-container" style="height: 350px;"><canvas id="specialtyChart"></canvas>
                            </div>
                            <div id="top-specialties-list" style="display:none;">

                                <!-- Dynamic List -->

                            </div>

                        </div>

                    </div>

                </section>



                <section id="reports-section" class="view-section">

                    <div class="glass-box">

                        <div class="box-header">

                            <h3><i class="fas fa-file-invoice"></i> إنشاء تقرير إحصائي وطني مخصص</h3>

                        </div>

                        <div
                            style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:15px; align-items:end; margin-bottom:30px; background:#f8fafc; padding:20px; border-radius:15px; border:1px solid #e2e8f0;">

                            <div>

                                <label style="display:block; margin-bottom:8px; font-weight:600; color:#475569;">نطاق

                                    التغطية:</label>

                                <select id="report-wilaya-select"
                                    style="width:100%; padding:10px; border-radius:8px; border:1px solid #cbd5e1;">

                                    <option value="all">كل الولايات (تقرير وطني)</option>

                                    <!-- Dynamic Wilayas -->

                                </select>

                            </div>

                            <div>

                                <label style="display:block; margin-bottom:8px; font-weight:600; color:#475569;">من

                                    تاريخ:</label>

                                <input type="date" id="report-start-date"
                                    style="width:100%; padding:10px; border-radius:8px; border:1px solid #cbd5e1;">

                            </div>

                            <div>

                                <label style="display:block; margin-bottom:8px; font-weight:600; color:#475569;">إلى

                                    تاريخ:</label>

                                <input type="date" id="report-end-date"
                                    style="width:100%; padding:10px; border-radius:8px; border:1px solid #cbd5e1;">

                            </div>

                            <div style="display:flex; align-items:flex-end;">

                                <button class="filter-submit-btn" onclick="filterReportsPreview()"
                                    style="height:45px; background:var(--primary); width:100%; border:none; border-radius:12px; color:white; font-weight:700; cursor:pointer; transition:0.3s; display:flex; align-items:center; justify-content:center; gap:10px;">

                                    <i class="fas fa-filter"></i> تطبيق التصفية

                                </button>

                            </div>

                            <style>
                                .filter-submit-btn:hover {

                                    background: var(--primary-light) !important;

                                    transform: translateY(-2px);

                                    box-shadow: 0 4px 12px rgba(6, 95, 70, 0.2);

                                }



                                .filter-submit-btn:active {

                                    transform: translateY(0);

                                }



                                /* Notifications Dropdown */

                                .notifications-dropdown {

                                    position: absolute;

                                    top: 70px;

                                    left: 20px;

                                    width: 350px;

                                    background: white;

                                    border-radius: 16px;

                                    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);

                                    display: none;

                                    flex-direction: column;

                                    z-index: 1000;

                                    border: 1px solid #eee;

                                    overflow: hidden;

                                    animation: slideDown 0.3s ease;

                                }

                                @keyframes slideDown {
                                    from {
                                        transform: translateY(-10px);
                                        opacity: 0;
                                    }

                                    to {
                                        transform: translateY(0);
                                        opacity: 1;
                                    }
                                }



                                .notif-header {

                                    padding: 15px 20px;

                                    background: #f8fafc;

                                    border-bottom: 1px solid #eee;

                                    display: flex;

                                    justify-content: space-between;

                                    align-items: center;

                                }

                                .notif-header h4 {
                                    margin: 0;
                                    color: var(--primary);
                                    font-size: 1rem;
                                }

                                .notif-list {

                                    max-height: 400px;

                                    overflow-y: auto;

                                }

                                .notif-item {

                                    padding: 12px 20px;

                                    border-bottom: 1px solid #f1f5f9;

                                    display: flex;

                                    gap: 12px;

                                    transition: 0.2s;

                                    cursor: pointer;

                                    text-align: right;

                                    align-items: center;

                                }

                                .notif-item:hover {
                                    background: #f0fdf4;
                                }

                                .notif-item i {
                                    color: #10b981;
                                }

                                .notif-item-content {
                                    flex: 1;
                                }

                                .notif-title {
                                    font-weight: 700;
                                    font-size: 0.85rem;
                                    margin-bottom: 2px;
                                }

                                .notif-time {
                                    font-size: 0.7rem;
                                    color: #94a3b8;
                                }



                                /* Global Search Style */

                                .search-box-container {

                                    position: absolute;

                                    top: 20px;

                                    right: 80px;

                                    z-index: 1000;

                                    width: 300px;

                                }

                                .search-input-wrapper {

                                    background: white;

                                    border-radius: 30px;

                                    padding: 8px 15px;

                                    display: flex;

                                    align-items: center;

                                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);

                                    border: 1px solid #ddd;

                                }

                                .search-input-wrapper input {

                                    border: none;

                                    outline: none;

                                    width: 100%;

                                    margin-right: 10px;

                                    font-family: 'Cairo', sans-serif;

                                    font-size: 0.9rem;

                                }



                                /* Dark Mode variables and classes */

                                body.dark-mode {

                                    background: #0f172a;

                                    color: #f8fafc;

                                }

                                .dark-mode .workbench,
                                .dark-mode .top-bar,
                                .dark-mode footer {

                                    background: #1e293b;

                                    color: white;

                                    border-color: #334155;

                                }

                                .dark-mode .metric-card,
                                .dark-mode .glass-box,
                                .dark-mode .modern-table tbody tr {

                                    background: #334155;

                                    color: white;

                                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);

                                    border-color: #475569;

                                }

                                .dark-mode .top-bar h2,
                                .dark-mode .user-info .name {
                                    color: #f8fafc;
                                }

                                .dark-mode .modern-table th {
                                    color: #94a3b8;
                                }

                                .dark-mode .modern-table td {
                                    color: #e2e8f0;
                                }

                                .dark-mode .sidebar {
                                    background: #020617;
                                }

                                .dark-mode .sidebar-header {
                                    border-bottom-color: #1e293b;
                                }



                                .theme-toggle-btn {

                                    background: #f1f5f9;

                                    border: 1px solid #ddd;

                                    width: 40px;

                                    height: 40px;

                                    border-radius: 50%;

                                    cursor: pointer;

                                    display: flex;

                                    align-items: center;

                                    justify-content: center;

                                    transition: 0.3s;

                                    margin-left: 15px;

                                }

                                .dark-mode .theme-toggle-btn {

                                    background: #334155;

                                    border-color: #475569;

                                    color: #fbbf24;

                                }


                                .hamburger-menu {
                                    display: none;
                                    font-size: 1.5rem;
                                    cursor: pointer;
                                    color: var(--primary);
                                    margin-left: 15px;
                                }

                                .sidebar-overlay {
                                    display: none;
                                    position: fixed;
                                    top: 0;
                                    left: 0;
                                    width: 100%;
                                    height: 100%;
                                    background: rgba(0, 0, 0, 0.5);
                                    z-index: 10000;
                                }

                                .sidebar-overlay.active {
                                    display: block;
                                }

                                /* === RESPONSIVE DESIGN FOR MOBILE === */
                                @media (max-width: 768px) {
                                    .sidebar {
                                        position: fixed;
                                        right: -280px;
                                        top: 0;
                                        bottom: 0;
                                        z-index: 10001;
                                        width: 280px !important;
                                        transition: 0.3s;
                                        display: flex !important;
                                    }

                                    .sidebar.active {
                                        right: 0;
                                    }

                                    .sidebar-overlay {
                                        display: none;
                                        position: fixed;
                                        top: 0;
                                        left: 0;
                                        width: 100%;
                                        height: 100%;
                                        background: rgba(0, 0, 0, 0.5);
                                        z-index: 10000;
                                    }

                                    .sidebar-overlay.active {
                                        display: block;
                                    }

                                    .hamburger-menu {
                                        display: block !important;
                                    }

                                    /* Mobile Nav Links Fix */
                                    .nav-items {
                                        display: flex;
                                        flex-direction: column;
                                        padding: 0 10px;
                                    }

                                    .nav-link {
                                        display: flex;
                                        align-items: center;
                                        justify-content: flex-start;
                                        width: 100%;
                                        padding: 12px 15px;
                                        margin-bottom: 8px;
                                        font-size: 0.95rem;
                                        white-space: nowrap;
                                        border-radius: 12px;
                                    }

                                    .nav-link i {
                                        margin-left: 15px;
                                        width: 25px;
                                        text-align: center;
                                        font-size: 1.1rem;
                                    }

                                    .app-container {
                                        flex-direction: column;
                                    }

                                    .sidebar-header img {
                                        width: 120px;
                                    }

                                    .top-bar {
                                        height: auto;
                                        padding: 15px;
                                        flex-wrap: wrap;
                                    }

                                    .top-right-title h2 {
                                        font-size: 0.85rem !important;
                                    }

                                    .top-left-actions {
                                        width: 100%;
                                        margin-top: 10px;
                                        justify-content: space-around;
                                    }

                                    .metrics-grid {
                                        grid-template-columns: 1fr !important;
                                        gap: 15px;
                                    }

                                    .dashboard-row {
                                        grid-template-columns: 1fr !important;
                                        gap: 15px;
                                    }

                                    .table-container {
                                        overflow-x: auto;
                                    }

                                    .chart-container {
                                        height: 250px !important;
                                    }

                                    #algeria-map {
                                        height: 300px !important;
                                    }

                                    .search-box-container {
                                        position: static;
                                        width: 100%;
                                        margin: 10px 0;
                                    }

                                    .user-profile {
                                        flex-direction: column;
                                        padding: 10px;
                                        border: none !important;
                                    }
                                }
                            </style>

                        </div>



                        <div id="report-preview-area" style="display:none;">

                            <div
                                style="background:#f0fdf4; padding:15px; border-radius:10px; margin-bottom:20px; border-right:5px solid #10b981;">

                                <h4 id="report-summary-text" style="color:#166534;"></h4>

                            </div>

                            <table class="modern-table" style="font-size:0.8rem;">

                                <thead>

                                    <tr>

                                        <th>كود</th>

                                        <th>الولاية</th>

                                        <th>الدورات</th>

                                        <th>المتربصين</th>

                                        <th>ذ/ث</th>

                                        <th>الطلبات</th>

                                        <th>المكونين</th>

                                        <th>الاتفاقيات</th>

                                        <th>التحديث</th>

                                    </tr>

                                </thead>

                                <tbody id="report-preview-table"></tbody>

                            </table>

                            <div style="margin-top:30px; display:flex; justify-content:center; gap:20px;">

                                <button class="login-btn" onclick="generateFilteredPDF()"
                                    style="width:auto; padding:15px 40px; font-size:1.1rem; background:#ef4444;">

                                    <i class="fas fa-file-pdf"></i> تحميل التقرير (PDF)

                                </button>

                                <button class="login-btn" onclick="generateFilteredWord()"
                                    style="width:auto; padding:15px 40px; font-size:1.1rem; background:#2563eb;">

                                    <i class="fas fa-file-word"></i> تحميل التقرير (Word)

                                </button>

                            </div>

                        </div>

                    </div>

                </section>



                </section>

                <!-- Settings Section -->
                <section id="settings-section" class="view-section">
                    <h2 class="section-title" style="margin-bottom: 25px; color: var(--primary);"><i
                            class="fas fa-cog"></i> إعدادات النظام</h2>

                    <div class="dashboard-row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px;">
                        <!-- Data & Sync Settings -->
                        <div class="glass-box"
                            style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
                            <div class="box-header"
                                style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">
                                <h3 style="font-size: 1.1rem; color: var(--primary);"><i class="fas fa-sync-alt"></i>
                                    المزامنة والبيانات</h3>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <label>تحديث البيانات تلقائياً</label>
                                    <input type="checkbox" id="auto-refresh-check" checked>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <label>فترة التحديث (بالدقائق)</label>
                                    <input type="number" id="refresh-interval" value="5"
                                        style="width: 60px; padding: 5px; border-radius: 5px; border: 1px solid #ddd;">
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <label>تنبيهات المزامنة</label>
                                    <input type="checkbox" id="sync-notif-check" checked>
                                </div>
                            </div>
                        </div>

                        <!-- Account & Personal Settings -->
                        <div class="glass-box"
                            style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
                            <div class="box-header"
                                style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">
                                <h3 style="font-size: 1.1rem; color: var(--primary);"><i class="fas fa-user-circle"></i>
                                    إعدادات الحساب</h3>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                    <label style="font-size: 0.9rem;">اسم العرض</label>
                                    <input type="text" id="display-name-val" value="يسين عيشي"
                                        style="padding: 8px; border-radius: 8px; border: 1px solid #ddd;">
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                    <label style="font-size: 0.9rem;">البريد الإلكتروني</label>
                                    <input type="email" id="display-email-val" value="y.aichi@tourism.gov.dz"
                                        style="padding: 8px; border-radius: 8px; border: 1px solid #ddd;">
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                    <label style="font-size: 0.9rem;">اسم المستخدم (للدخول)</label>
                                    <input type="text" id="display-user-val"
                                        style="padding: 8px; border-radius: 8px; border: 1px solid #ddd;">
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                    <label style="font-size: 0.9rem;">كلمة المرور الجديدة</label>
                                    <input type="password" id="display-pass-val" placeholder="••••••••"
                                        style="padding: 8px; border-radius: 8px; border: 1px solid #ddd;">
                                </div>
                                <button onclick="saveAccountSettings()" class="login-btn"
                                    style="width: 100%; margin-top: 10px;">حفظ التغييرات</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Security Section -->
                <section id="security-section" class="view-section">
                    <h2 class="section-title" style="margin-bottom: 25px; color: var(--primary);"><i
                            class="fas fa-shield-halved"></i> الأمان وسجلات النظام</h2>

                    <div class="metrics-grid">

                        <div class="metric-card">

                            <div class="m-icon" style="background:#f0fdf4; color:#10b981;"><i
                                    class="fas fa-check-shield"></i></div>

                            <div class="m-data">

                                <h4>حالة النظام</h4>

                                <div class="value" style="color:#10b981;">مؤمن</div>

                            </div>

                        </div>

                        <div class="metric-card">

                            <div class="m-icon blue"><i class="fas fa-user-lock"></i></div>

                            <div class="m-data">

                                <h4>الجلسات النشطة</h4>

                                <div class="value">1</div>

                            </div>

                        </div>

                        <div class="metric-card">

                            <div class="m-icon red"><i class="fas fa-user-slash"></i></div>

                            <div class="m-data">

                                <h4>محاولات مرفوضة</h4>

                                <div class="value" id="blocked-attempts">0</div>

                            </div>

                        </div>

                        <div class="metric-card">

                            <div class="m-icon orange"><i class="fas fa-sync"></i></div>

                            <div class="m-data">

                                <h4>آخر فحص أمني</h4>

                                <div class="value" style="font-size:1rem;">الآن</div>

                            </div>

                        </div>

                    </div>



                    <div class="glass-box">

                        <div class="box-header">

                            <h3><i class="fas fa-history"></i> سجلات الوصول والعمليات الإدارية</h3>

                            <div style="font-size:0.8rem; color:var(--text-muted);"><i class="fas fa-info-circle"></i>

                                يتم تسجيل كافة العمليات للأرشفة الأمنية</div>

                        </div>

                        <table class="modern-table">

                            <thead>

                                <tr>

                                    <th>المستخدم</th>

                                    <th>العملية</th>

                                    <th>التوقيت</th>

                                    <th>العنوان الرقمي (IP)</th>

                                    <th>الحالة</th>

                                </tr>

                            </thead>

                            <tbody id="security-logs-body">

                                <!-- Dynamic Logs -->

                            </tbody>

                        </table>

                    </div>

                </section>



                <footer><strong>غرفة العمليات المركزية</strong> - وزارة السياحة والصناعة التقليدية | تطوير: <strong>عيشي

                        يسين</strong> (0660639890)</footer>

            </div>

        </main>

    </div>



    <div id="wilaya-modal" class="modal-overlay" onclick="closeModal()">

        <div class="modal-card" onclick="event.stopPropagation()">

            <div class="modal-header-pro">

                <h3 id="modal-wilaya-name"></h3><i class="fas fa-times" onclick="closeModal()"
                    style="cursor: pointer;"></i>

            </div>

            <div class="modal-body-pro" id="modal-wilaya-body"></div>

        </div>

    </div>



    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script src="data/wilayas_coords.js"></script>

    <script>

        const script = document.createElement('script');

        script.src = 'data/stats.js?v=' + Date.now();

        script.onload = () => { initDashboard(); };
        document.head.appendChild(script);

        // Sidebar Toggle Logic
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (sidebar) sidebar.classList.toggle('active');
            if (overlay) overlay.classList.toggle('active');
        }

        function closeSidebarOnMobile() {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                if (sidebar) sidebar.classList.remove('active');
                if (overlay) overlay.classList.remove('active');
            }
        }



        function refreshStats() {

            const oldScript = document.querySelector('script[src*="stats.js"]');

            if (oldScript) oldScript.remove();

            const s = document.createElement('script');

            s.src = 'data/stats.js?v=' + Date.now();

            s.onload = () => { initDashboard(); alert("تم تحديث البيانات بنجاح."); };

            document.head.appendChild(s);

        }



        function checkLogin() {
            const uInput = document.getElementById('username').value.trim().toLowerCase();
            const pInput = document.getElementById('password').value.trim();

            const savedU = localStorage.getItem('csm_login_user') || 'admin';
            const savedP = localStorage.getItem('csm_login_pass') || 'admin';

            if (uInput === savedU && pInput === savedP) {
                localStorage.setItem('isLogged', 'true');
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('dashboard-app').style.display = 'flex';
                initDashboard();
            } else {
                const error = document.getElementById('login-error');
                if (error) error.style.display = 'block';
                alert('خطأ: اسم المستخدم أو كلمة المرور غير صحيحة.');
            }
        }



        function logout() { localStorage.removeItem('isLogged'); location.reload(); }



        window.onload = () => {

            if (localStorage.getItem('theme') === 'dark') toggleDarkMode();

            // Bypass login for user convenience during testing

            document.getElementById('login-overlay').style.display = 'none';

            document.getElementById('dashboard-app').style.display = 'flex';

            initDashboard();

        };



        function toggleDarkMode() {

            document.body.classList.toggle('dark-mode');

            const icon = document.querySelector('.theme-toggle-btn i');

            if (!icon) return;

            if (document.body.classList.contains('dark-mode')) {

                icon.className = 'fas fa-sun';

                localStorage.setItem('theme', 'dark');

            } else {

                icon.className = 'fas fa-moon';

                localStorage.setItem('theme', 'light');

            }

        }



        function handleGlobalSearch() {

            const q = document.getElementById('global-search').value.toLowerCase();

            if (!q) return;

            const res = ALL_WILAYAS.find(w => w.name.includes(q) || w.code === q);

            if (res && window.currentMap) {

                window.currentMap.setView([res.lat, res.lng], 8);

            }

        }



        function toggleNotifications(event) {

            if (event) event.stopPropagation();

            const d = document.getElementById('notif-dropdown');

            const b = document.getElementById('notif-badge');

            if (!d) return;



            if (d.style.display === 'flex') {

                d.style.display = 'none';

            } else {

                d.style.display = 'flex';

                // Mark as read user request

                if (b) {

                    b.innerText = '0';

                    b.style.backgroundColor = '#94a3b8'; // Muted grey

                }

            }

        }



        document.addEventListener('click', () => {

            const d = document.getElementById('notif-dropdown');

            if (d) d.style.display = 'none';

        });




        function switchView(viewId, el) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            const target = document.getElementById(viewId + '-section');
            if (target) target.classList.add('active');

            document.querySelectorAll('.nav-link').forEach(li => li.classList.remove('active'));
            if (el) el.classList.add('active');

            if (viewId === 'map') { setTimeout(() => { if (window.currentMap) window.currentMap.invalidateSize(); }, 300); }
            if (viewId === 'security') renderSecurityLogs();
            if (viewId === 'settings') loadSettingsState();
        }


        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (sidebar) sidebar.classList.toggle('active');
            if (overlay) overlay.classList.toggle('active');
        }

        function closeSidebarOnMobile() {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                if (sidebar) sidebar.classList.remove('active');
                if (overlay) overlay.classList.remove('active');
            }
        }

        function initDashboard() {
            let totalStud = 0, totalReq = 0, totalTeach = 0, activeC = 0;
            const statsMap = {};
            if (typeof NATIONAL_STATS !== 'undefined') {
                NATIONAL_STATS.forEach(item => { statsMap[String(item.code).padStart(2, '0')] = item; });
            }

            const tbody = document.getElementById('stats-table-body');
            const dir = document.getElementById('full-wilayas-directory');
            const ticker = document.getElementById('live-ticker');
            const notifList = document.getElementById('notif-list');

            if (tbody) tbody.innerHTML = "";
            if (dir) dir.innerHTML = "";
            if (ticker) ticker.innerHTML = "";
            if (notifList) notifList.innerHTML = "";

            let notifCount = 0;
            const reportSelect = document.getElementById('report-wilaya-select');
            if (reportSelect) reportSelect.innerHTML = '<option value="all">كل الولايات (تقرير وطني)</option>';

            ALL_WILAYAS.forEach(wilaya => {
                const data = statsMap[wilaya.code];
                if (data) {
                    totalStud += data.students; totalReq += (data.requests_total || 0); totalTeach += (data.teachers_count || 0); activeC++;
                    if (tbody) tbody.innerHTML += `<tr>
                        <td>#${wilaya.code}</td>
                        <td><span class="btn-link" onclick="showWilayaDetails('${wilaya.code}')">${wilaya.name}</span></td>
                        <td>${data.students} <small>(${data.students_male || 0}/${data.students_female || 0})</small></td>
                        <td>${data.performance ? data.performance.success_rate : 0}%</td>
                        <td>${data.performance ? data.performance.graduated_count : 0}</td>
                        <td>${data.most_active_course || '-'}</td>
                        <td style="font-size:0.8rem;">${data.last_updated}</td>
                        <td><span class="status-pill pill-active">نشط</span></td>
                    </tr>`;
                    if (ticker) ticker.innerHTML += `<div class="ticker-item"><i class="fas fa-check-circle"></i> تم تحديث بيانات ولاية ${wilaya.name} بنجاح (${data.students} متربص)</div>`;

                    notifCount++;
                    if (notifList) notifList.innerHTML += `
                        <div class="notif-item" onclick="showWilayaDetails('${wilaya.code}')">
                            <i class="fas fa-sync-alt"></i>
                            <div class="notif-item-content">
                                <div class="notif-title">مزامنة ولاية ${wilaya.name}</div>
                                <div class="notif-time">آخر تحديث: ${data.last_updated}</div>
                            </div>
                        </div>
                    `;
                } else {
                    if (tbody) tbody.innerHTML += `<tr style="opacity:0.5;"><td>#${wilaya.code}</td><td>${wilaya.name}</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><span class="status-pill pill-inactive">غير نشط</span></td></tr>`;
                }
                if (dir) dir.innerHTML += `<div class="wilaya-card" onclick="showWilayaDetails('${wilaya.code}')"><h4>${wilaya.name} <span class="code">${wilaya.code}</span></h4><div class="w-stat"><span>المتربصين:</span> <b>${data ? data.students : 0}</b></div><div class="w-stat"><span>الحالة:</span> <span class="status-dot ${data ? 'dot-online' : 'dot-offline'}"></span> ${data ? 'نشط' : 'غير متصل'}</div></div>`;

                if (reportSelect) reportSelect.innerHTML += `<option value="${wilaya.code}">${wilaya.name}</option>`;
            });

            if (document.getElementById('total-students')) document.getElementById('total-students').innerText = totalStud.toLocaleString();
            if (document.getElementById('total-requests')) document.getElementById('total-requests').innerText = totalReq.toLocaleString();
            if (document.getElementById('total-teachers')) document.getElementById('total-teachers').innerText = totalTeach.toLocaleString();
            if (document.getElementById('active-centers')) document.getElementById('active-centers').innerText = `${activeC} / 58`;
            if (document.getElementById('notif-badge')) document.getElementById('notif-badge').innerText = notifCount;
            if (document.getElementById('notif-count-text')) document.getElementById('notif-count-text').innerText = notifCount + ' ولاية نشطة';

            const sorted = Object.values(statsMap).sort((a, b) => b.students - a.students).slice(0, 5);
            renderCharts(sorted, statsMap);
            renderMap(statsMap);
        }



        let charts = {};



        function renderCharts(sortedWilayas, statsMap) {

            Object.values(charts).forEach(c => c.destroy());



            // 1. Top Wilayas Bar

            const ctxTop = document.getElementById('topWilayasChart').getContext('2d');

            charts.top = new Chart(ctxTop, {

                type: 'bar',

                data: {

                    labels: sortedWilayas.map(d => d.name),

                    datasets: [{ label: 'المتربصين', data: sortedWilayas.map(d => d.students), backgroundColor: '#10b981', borderRadius: 8 }]

                },

                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }

            });



            // Aggregate National Data for Specialties and Levels

            let m = 0, f = 0, edu = {}, specs = {};

            Object.values(statsMap).forEach(d => {

                m += (d.students_male || 0); f += (d.students_female || 0);

                if (d.students_edu_levels) Object.entries(d.students_edu_levels).forEach(([k, v]) => edu[k] = (edu[k] || 0) + v);

                if (d.most_active_course) specs[d.most_active_course] = (specs[d.most_active_course] || 0) + 1;

            });



            // 2. Gender Doughnut

            const ctxGender = document.getElementById('genderChart').getContext('2d');

            charts.gender = new Chart(ctxGender, {

                type: 'doughnut',

                data: { labels: ['ذكور', 'إناث'], datasets: [{ data: [m, f], backgroundColor: ['#3b82f6', '#ec4899'] }] },

                options: { responsive: true, maintainAspectRatio: false }

            });



            // 3. Education Polar

            const ctxEdu = document.getElementById('educationChart').getContext('2d');

            charts.edu = new Chart(ctxEdu, {

                type: 'polarArea',

                data: { labels: Object.keys(edu), datasets: [{ data: Object.values(edu), backgroundColor: ['#f59e0b', '#10b981', '#6366f1', '#8b5cf6'] }] },

                options: { responsive: true, maintainAspectRatio: false }

            });



            // 4. Specialty Chart
            const ctxSpec = document.getElementById('specialtyChart');
            if (ctxSpec) {
                charts.spec = new Chart(ctxSpec.getContext('2d'), {
                    type: 'polarArea',
                    data: {
                        labels: Object.keys(specs).slice(0, 7),
                        datasets: [{
                            data: Object.values(specs).slice(0, 7),
                            backgroundColor: ['rgba(16,185,129,0.7)', 'rgba(59,130,246,0.7)', 'rgba(245,158,11,0.7)', 'rgba(239,68,68,0.7)', 'rgba(139,92,246,0.7)', 'rgba(236,72,153,0.7)', 'rgba(20,184,166,0.7)']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }

            // 5. Comparison Chart
            const ctxComp = document.getElementById('comparisonChart');
            if (ctxComp) {
                charts.comp = new Chart(ctxComp.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: sortedWilayas.map(d => d.name),
                        datasets: [
                            { label: 'المتربصين', data: sortedWilayas.map(d => d.students), backgroundColor: '#10b981' },
                            { label: 'طلبات التسجيل', data: sortedWilayas.map(d => d.requests_total || 0), backgroundColor: '#f59e0b' }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: false }, y: { beginAtZero: true } } }
                });
            }

            // --- New Extended Charts ---

            // 6. Age Groups
            const ctxAge = document.getElementById('ageGroupsChart');
            if (ctxAge) {
                let ageStats = { '15-18': 0, '19-25': 0, '26-35': 0, '35+': 0 };
                Object.values(statsMap).forEach(d => {
                    if (d.age_groups) {
                        Object.entries(d.age_groups).forEach(([k, v]) => ageStats[k] = (ageStats[k] || 0) + v);
                    }
                });
                charts.age = new Chart(ctxAge.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: Object.keys(ageStats),
                        datasets: [{
                            data: Object.values(ageStats),
                            backgroundColor: ['#22c55e', '#3b82f6', '#f59e0b', '#64748b']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }

            // 7. Training Types
            const ctxTrain = document.getElementById('trainingTypeChart');
            if (ctxTrain) {
                let trainStats = {};
                Object.values(statsMap).forEach(d => {
                    if (d.training_types) {
                        Object.entries(d.training_types).forEach(([k, v]) => trainStats[k] = (trainStats[k] || 0) + v);
                    }
                });
                charts.train = new Chart(ctxTrain.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(trainStats).length ? Object.keys(trainStats) : ['عادي'],
                        datasets: [{
                            data: Object.values(trainStats).length ? Object.values(trainStats) : [1],
                            backgroundColor: ['#8b5cf6', '#ec4899', '#06b6d4', '#f97316']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }
        }

        function getHeatColor(count) {
            if (count > 200) return '#065f46';
            if (count > 100) return '#059669';
            if (count > 50) return '#10b981';
            if (count > 0) return '#34d399';
            return '#94a3b8';
        }



        function renderMap(sm) {

            if (window.currentMap) window.currentMap.remove();

            const map = L.map('algeria-map').setView([28.03, 2.0], 5.2);

            window.currentMap = map;

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);



            if (typeof ALL_WILAYAS !== 'undefined') {

                ALL_WILAYAS.forEach(w => {

                    const d = sm[w.code];

                    const count = d ? d.students : 0;

                    L.circleMarker([w.lat, w.lng], {

                        radius: d ? Math.min(15, 6 + (count / 20)) : 4,

                        fillColor: getHeatColor(count),

                        color: '#fff', weight: 1.5, fillOpacity: 0.85

                    }).addTo(map)

                        .bindPopup(`<div style="direction:rtl; text-align:right; font-family:Cairo;"><strong>ولاية ${w.name}</strong><br>${d ? 'المتربصين: ' + d.students : 'لا توجد بيانات'}</div>`)

                        .on('click', () => showWilayaDetails(w.code));

                });

            }

            setTimeout(() => map.invalidateSize(), 600);

        }




        function showWilayaDetails(code) {
            const wilaya = ALL_WILAYAS.find(w => String(w.code).padStart(2, '0') === String(code).padStart(2, '0'));
            const data = (typeof NATIONAL_STATS !== 'undefined') ? NATIONAL_STATS.find(s => String(s.code).padStart(2, '0') === String(code).padStart(2, '0')) : null;
            const modal = document.getElementById('wilaya-modal');
            const nameEl = document.getElementById('modal-wilaya-name');
            const body = document.getElementById('modal-wilaya-body');

            nameEl.innerText = "تفاصيل ولاية " + wilaya.name;

            if (data) {
                const m = data.students_male || 0;
                const f = data.students_female || 0;
                const req = data.requests_total || 0;
                const teach = data.teachers_count || 0;
                const agree = data.agreements_count || 0;
                const course = data.most_active_course || 'لا يوجد';

                let eduHtml = '<div style="margin-top:15px; display:flex; gap:10px; flex-wrap:wrap;">';
                if (data.students_edu_levels) {
                    Object.entries(data.students_edu_levels).forEach(([k, v]) => {
                        eduHtml += `<span style="background:#e0f2fe; color:#0284c7; padding:4px 10px; border-radius:15px; font-size:0.75rem;">${k}: ${v}</span>`;
                    });
                }
                eduHtml += '</div>';

                let ageHtml = '<div style="margin-top:15px; display:flex; gap:10px; flex-wrap:wrap;">';
                if (data.age_groups) {
                    Object.entries(data.age_groups).forEach(([k, v]) => {
                        ageHtml += `<span style="background:#fef3c7; color:#92400e; padding:4px 10px; border-radius:15px; font-size:0.75rem;">عمر ${k}: ${v}</span>`;
                    });
                }
                ageHtml += '</div>';

                body.innerHTML = `
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;">
                        <div class="glass-box" style="padding:15px; background:#f0fdf4;">
                            <h4 style="color:var(--primary); margin-bottom:10px;"><i class="fas fa-user-graduate"></i> المتربصين</h4>
                            <div style="font-size:1.1rem; font-weight:700;">${data.students} <small>(ذكور: ${m} / إناث: ${f})</small></div>
                        </div>
                        <div class="glass-box" style="padding:15px; background:#f8fafc;">
                            <h4 style="color:var(--secondary); margin-bottom:10px;"><i class="fas fa-file-invoice"></i> الطلبات</h4>
                            <div style="font-size:1.1rem; font-weight:700;">${req} طلب تسجيل</div>
                        </div>
                    </div>
                    
                    <div style="margin-top:20px; display:grid; grid-template-columns:1fr 1fr; gap:15px; border-top:1px solid #eee; padding-top:15px;">
                        <div><i class="fas fa-chalkboard-teacher" style="color:#64748b;"></i> <b>عدد المعلمين:</b> ${teach}</div>
                        <div><i class="fas fa-handshake" style="color:#64748b;"></i> <b>الاتفاقيات:</b> ${agree}</div>
                        <div><i class="fas fa-percent" style="color:#64748b;"></i> <b>نسبة النجاح:</b> ${data.performance ? data.performance.success_rate : 0}%</div>
                        <div><i class="fas fa-user-check" style="color:#64748b;"></i> <b>المتخرجين:</b> ${data.performance ? data.performance.graduated_count : 0}</div>
                    </div>

                    <div style="margin-top:15px; padding:10px; background:#fff7ed; border-radius:10px; border:1px solid #ffedd5;">
                        <b><i class="fas fa-fire" style="color:#ea580c;"></i> التخصص الأنشط:</b> <span style="color:#9a3412; font-weight:bold;">${course}</span>
                    </div>

                    ${eduHtml}
                    ${ageHtml}

                    <div style="margin-top:25px; font-size:0.8rem; color:var(--text-muted); border-top:1px solid #eee; padding-top:15px; display:flex; justify-content:space-between;">
                        <span>كود الولاية: #${wilaya.code}</span>
                        <span>آخر تحديث: ${data.last_updated}</span>
                    </div>
                `;
            } else {
                body.innerHTML = `
                    <div style="text-align:center; padding:40px;">
                        <i class="fas fa-signal-slash" style="font-size:3rem; color:#cbd5e1; margin-bottom:15px;"></i>
                        <p style="color:#64748b;">لم يتم استلام أي بيانات لهذه الولاية.<br>يرجى التحقق من الاتصال.</p>
                    </div>
                `;
            }
            modal.style.display = 'flex';
        }

        function closeModal() { document.getElementById('wilaya-modal').style.display = 'none'; }





        const SYSTEM_LOGS = [

            { user: 'admin', action: 'تسجيل دخول ناجح', time: '2026-01-12 17:58:30', ip: '192.168.1.42', status: 'نجاح' },

            { user: 'system', action: 'مزامنة بيانات تلقائية', time: '2026-01-12 18:00:00', ip: 'Localhost', status: 'نجاح' },

            { user: 'admin', action: 'تغيير إعدادات النظام', time: '2026-01-12 18:05:12', ip: '192.168.1.42', status: 'نجاح' },

            { user: 'unknown', action: 'محاولة دخول فاشلة', time: '2026-01-12 19:22:45', ip: '10.5.2.19', status: 'فشل' }

        ];



        function renderSecurityLogs() {

            const tbody = document.getElementById('security-logs-body');

            if (!tbody) return;

            tbody.innerHTML = "";

            SYSTEM_LOGS.slice().reverse().forEach(log => {

                tbody.innerHTML += `<tr>

                    <td><i class="fas fa-user-circle"></i> ${log.user}</td>

                    <td>${log.action}</td>

                    <td style="font-size:0.8rem; color:var(--text-muted);">${log.time}</td>

                    <td style="font-family:monospace; font-size:0.8rem;">${log.ip}</td>

                    <td><span class="status-pill ${log.status === 'نجاح' ? 'pill-active' : 'pill-inactive'}">${log.status}</span></td>

                </tr>`;

            });

        }






        function filterReportsPreview() {
            const wCode = document.getElementById('report-wilaya-select').value;
            const startStr = document.getElementById('report-start-date').value;
            const endStr = document.getElementById('report-end-date').value;

            if (!startStr || !endStr) { alert("يرجى تحديد فترة زمنية للتقرير."); return; }

            const tbody = document.getElementById('report-preview-table');
            const summary = document.getElementById('report-summary-text');
            const previewArea = document.getElementById('report-preview-area');

            if (!tbody) return;
            tbody.innerHTML = "";
            previewArea.style.display = 'block';

            let filtered = [];
            if (wCode === 'all') {
                if (typeof NATIONAL_STATS !== 'undefined') filtered = NATIONAL_STATS;
                summary.innerText = `تقرير وطني شامل - الفترة: ${startStr} إلى ${endStr}`;
            } else {
                if (typeof NATIONAL_STATS !== 'undefined') {
                    const found = NATIONAL_STATS.find(s => String(s.code).padStart(2, '0') === String(wCode).padStart(2, '0'));
                    if (found) filtered = [found];
                }
                const wName = document.getElementById('report-wilaya-select').options[document.getElementById('report-wilaya-select').selectedIndex].text;
                summary.innerText = `تقرير ولاية ${wName} - الفترة: ${startStr} إلى ${endStr}`;
            }

            if (filtered.length === 0) {
                tbody.innerHTML = "<tr><td colspan='10' style='text-align:center;'>لا توجد بيانات لهذه الفترة.</td></tr>";
                return;
            }

            filtered.forEach(d => {
                const w = ALL_WILAYAS.find(x => x.code === d.code);
                tbody.innerHTML += `<tr>
                    <td>#${d.code}</td>
                    <td><b>${w ? w.name : d.code}</b></td>
                    <td>${d.courses || 0}</td>
                    <td>${d.students || 0}</td>
                    <td>${(d.students_male || 0)}/${(d.students_female || 0)}</td>
                    <td>${d.requests_total || 0}</td>
                    <td>${d.teachers_count || 0}</td>
                    <td>${d.performance ? (d.performance.success_rate + '%') : '0%'}</td>
                    <td>${d.last_updated}</td>
                </tr>`;
            });
        }

        function saveAccountSettings() {
            const name = document.getElementById('display-name-val').value;
            const email = document.getElementById('display-email-val').value;
            const user = document.getElementById('display-user-val').value;
            const pass = document.getElementById('display-pass-val').value;

            localStorage.setItem('csm_user_name', name);
            localStorage.setItem('csm_user_email', email);
            if (user) localStorage.setItem('csm_login_user', user);
            if (pass) localStorage.setItem('csm_login_pass', pass);

            const profileName = document.querySelector('.user-info .name');
            if (profileName) profileName.innerText = name;

            alert("تم حفظ الإعدادات بنجاح!");
        }

        function loadSettingsState() {
            const name = localStorage.getItem('csm_user_name') || 'يسين عيشي';
            const email = localStorage.getItem('csm_user_email') || 'y.aichi@tourism.gov.dz';
            const user = localStorage.getItem('csm_login_user') || 'admin';

            document.getElementById('display-name-val').value = name;
            document.getElementById('display-email-val').value = email;
            document.getElementById('display-user-val').value = user;

            const profileName = document.querySelector('.user-info .name');
            if (profileName) profileName.innerText = name;
        }

        // Initialize Settings
        document.addEventListener('DOMContentLoaded', loadSettingsState);

        function generateFilteredPDF() {

            const element = document.getElementById('report-preview-area');

            if (!element || element.style.display === 'none') {

                alert("يرجى تصفية التقرير أولاً.");

                return;

            }



            // Add Logo for PDF

            const originalHeader = element.innerHTML;

            const logoHtml = `<div style="text-align:center; margin-bottom:20px;">

                <img src="assets/img/logo%20minister.png" style="width:200px;">

                <h2 style="margin-top:10px;">الجمهورية الجزائرية الديمقراطية الشعبية</h2>

                <h3>وزارة السياحة والصناعة التقليدية</h3>

            </div>`;



            // Temporary container for clean PDF print

            const printContainer = document.createElement('div');

            printContainer.innerHTML = logoHtml + element.innerHTML;

            printContainer.style.padding = '20px';

            printContainer.style.fontFamily = 'Cairo, sans-serif';

            printContainer.style.direction = 'rtl';



            const opt = {

                margin: 10,

                filename: 'CSM_Report_' + new Date().toISOString().slice(0, 10) + '.pdf',

                image: { type: 'jpeg', quality: 0.98 },

                html2canvas: { scale: 2 },

                jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }

            };



            // Use html2pdf

            html2pdf().set(opt).from(printContainer).save().then(() => {

                alert("تم تحميل ملف PDF بنجاح.");

            }).catch(err => {

                console.error(err);

                alert("حدث خطأ أثناء توليد PDF.");

            });

        }



        function generateFilteredWord() {

            const element = document.getElementById('report-preview-area');

            if (!element || element.style.display === 'none') {

                alert("يرجى تصفية التقرير أولاً.");

                return;

            }



            const header = `

                <html xmlns:o='urn:schemas-microsoft-com:office:office' 

                      xmlns:w='urn:schemas-microsoft-com:office:word' 

                      xmlns='http://www.w3.org/TR/REC-html40'>

                <head><meta charset='utf-8'><title>Report</title>

                <style>body{font-family:'Arial'; direction:rtl; text-align:right;} table{width:100%; border-collapse:collapse;} td,th{border:1px solid #000; padding:5px;}
        
        .hamburger-menu {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--primary);
            margin-left: 15px;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
        }

        .sidebar-overlay.active {
            display: block;
        }
    
                                /* === RESPONSIVE DESIGN FOR MOBILE === */
        @media (max-width: 768px) {
            .app-container { flex-direction: column; }
            .sidebar { width: 100%; height: auto; padding: 15px 0; }
            .sidebar-header img { width: 120px; }
            .nav-items { display: flex; overflow-x: auto; gap: 10px; padding: 10px; }
            .nav-link { white-space: nowrap; flex-shrink: 0; }
            .top-bar { height: auto; padding: 15px; flex-wrap: wrap; }
            .top-right-title h2 { font-size: 0.9rem !important; }
            .top-left-actions { width: 100%; margin-top: 10px; justify-content: space-around; }
            .ticker-bar { font-size: 0.7rem; padding: 8px 0; }
            .ticker-label { font-size: 0.7rem; padding: 0 10px; }
            .main-content { padding: 15px; }
            .metrics-grid { grid-template-columns: 1fr !important; gap: 15px; }
            .dashboard-row { grid-template-columns: 1fr !important; gap: 15px; }
            .wilayas-grid { grid-template-columns: 1fr !important; }
            .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .modern-table { min-width: 700px; font-size: 0.8rem; }
            .modern-table th, .modern-table td { padding: 10px 8px; font-size: 0.75rem; }
            .glass-box { padding: 15px; }
            .box-header { flex-direction: column; align-items: flex-start !important; gap: 10px; }
            .box-header h3 { font-size: 0.95rem; }
            .chart-container { height: 250px !important; }
            #algeria-map { height: 350px !important; }
            .login-glass { width: 90%; padding: 25px; }
            .modal-card { width: 95%; margin: 0 10px; }
            .modal-body-pro { padding: 20px; }
            .metric-card { padding: 18px; flex-direction: row; }
            .m-icon { width: 50px; height: 50px; font-size: 1.4rem; }
            .m-data .value { font-size: 1.4rem; }
            .m-data h4 { font-size: 0.8rem; }
            .search-box-container { position: static; width: 100%; margin: 10px 0; }
            .notifications-dropdown { width: 95%; left: 2.5%; }
            .user-prof{ flexion: column; align-items: center; gap: 10px; padding: 10px; border: none !important; }
            .user-info { text-align: center; }
            footer { padding: 20px 15px; font-size: 0.8rem; }
            .login-btn { padding: 12px; font-size: 0.9rem; }
            .wilaya-card { padding: 15px; }
            .sidebar-footer { font-size: 0.7rem; padding: 10px; }
        }
    </style>

                </head><body>

                <div style="text-align:center;">

                    <h2>الجمهورية الجزائرية الديمقراطية الشعبية</h2>

                    <h3>وزارة السياحة والصناعة التقليدية</h3>

                    <br>

                </div>

            `;



            const footer = "</body></html>";

            const sourceHTML = header + element.innerHTML + footer;



            const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);

            const fileDownload = document.createElement("a");

            document.body.appendChild(fileDownload);

            fileDownload.href = source;

            fileDownload.download = 'CSM_Report_' + new Date().toISOString().slice(0, 10) + '.doc';

            fileDownload.click();

            document.body.removeChild(fileDownload);



            alert("تم تحميل ملف Word بنجاح.");

        }



    </script>

</body>



</html>